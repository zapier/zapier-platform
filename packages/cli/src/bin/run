#!/usr/bin/env node

const path = require('node:path');
const fs = require('node:fs');

(async () => {
  const oclif = await import('@oclif/core');
  await oclif.execute({ development: false, dir: __dirname });

  // Show deprecation warning for the old "zapier" binary name
  if (process.platform === 'win32') {
    // On Windows, we cannot reliably detect which wrapper was invoked (zapier vs zapier-platform)
    // because both wrappers point to the same script. Show a generic deprecation notice.
    try {
      const scriptDir = path.dirname(process.argv[1]);
      const parts = scriptDir.split(path.sep);
      const nodeModulesIndex = parts.lastIndexOf('node_modules');
      
      if (nodeModulesIndex !== -1) {
        const binDir = parts.slice(0, nodeModulesIndex).join(path.sep);
        const zapierExists = fs.existsSync(path.join(binDir, 'zapier.cmd')) || 
                            fs.existsSync(path.join(binDir, 'zapier.ps1'));
        
        if (zapierExists) {
          console.warn(
            '\n[DEPRECATION NOTICE] ' +
              'The "zapier" command is deprecated and will be removed in a future version. ' +
              'Please use "zapier-platform" instead.\n',
          );
        }
      }
    } catch (error) {
      // Silently fail if we can't detect - better than showing incorrect warnings
    }
  } else {
    // On Unix, we can detect which symlink was used
    const scriptPath = process.argv[1] || '';
    const binName = path.basename(scriptPath, path.extname(scriptPath));
    
    if (binName === 'zapier') {
      console.warn(
        '\n[DEPRECATION WARNING] ' +
          'The "zapier" command is deprecated and will be removed in a future version. ' +
          'Please use "zapier-platform" instead.\n',
      );
    }
  }
})();
